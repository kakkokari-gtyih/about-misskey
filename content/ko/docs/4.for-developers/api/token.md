# 액세스 토큰 획득하기

API를 사용하기 위해서는 API를 사용할 계정에 연결된 **액세스 토큰**을 발급받아야 합니다.
이 문서에서는 액세스 토큰을 획득하는 방법을 설명한 후, 기본적인 API 사용법을 설명합니다.

기본적으로 API는 요청 시 액세스 토큰이 필요합니다.
액세스 토큰은 사용자에 연결된 인증 정보로, API를 이용하는 사용자를 식별하는 동시에 액세스 토큰별로 어떤 작업 권한을 가지고 있는지 관리합니다.

:::tip

자신의 액세스 토큰을 쉽게 획득할 수 있을 뿐만 아니라, 자신의 애플리케이션을 사용하게 될 불특정 사용자의 액세스 토큰을 획득할 수도 있습니다.

:::

あなた自分自身のアクセストークンは簡単に取得できるほか、あなたのアプリケーションを使用することになる不特定のユーザーのアクセストークンを取得することもできます。

- 前者の場合: **「自分自身のアクセストークンを手動発行する」** に進む
- 後者の場合: **「アプリケーション利用者にアクセストークンの発行をリクエストする」** に進む

### 自分自身のアクセストークンを手動発行する

Misskey Webの「設定 > API」で、自分のアクセストークンを発行できます。

:::danger

アクセストークンは他人に知られないようにしてください。

:::

### アプリケーション利用者にアクセストークンの発行をリクエストする

アプリケーションを利用するユーザー(以下単に「ユーザー」と呼びます)のアクセストークンを取得するには、以下の手順で発行をリクエストします。

:::tip

以下に説明する方法は、アプリを作成せずインスタントにアクセストークンを発行する、MiAuthと呼ばれるものです。

[アプリ作成方式でのアクセストークン取得方法もあります（旧来型）。](./app)
:::

#### Step 1

UUIDを生成する。以後これを**セッションID**と呼びます。

:::danger

このセッションIDは毎回生成し、使いまわさないようにしてください。

:::

#### Step 2

アプリケーション認証フォームをユーザーのブラウザで表示させる。認証フォームは、以下の形式のURLで開くことができます:

```
https://misskey.io/miauth/c1f6d42b-468b-4fd2-8274-e58abdedef6f?name=MyApp&callback=https%3A%2F%2Fmyapp.example.com%2Fcallback&permission=write:notes,write:following,read:drive
```

ここで、

- `{host}`の部分は、ユーザーのサーバーのホストに置き換えます。通常ホストはユーザーが入力します。
- `{session}`の部分は、セッションIDに置き換えます。

사용자가 애플리케이션 접근을 허용한 후 다음 형식의 URL에 POST 요청하면 응답으로 액세스 토큰이 포함된 JSON이 반환됩니다.

| 名前           | 説明                                                                            |
| ------------ | ----------------------------------------------------------------------------- |
| `name`       | アプリケーション名。                                                                    |
| `icon`       | アプリケーションのアイコン画像URL。                                                           |
| `callback`   | 認証が終わった後にリダイレクトするURL。<br>リダイレクト時には、`session`というクエリパラメータでセッションIDが付きます。         |
| `permission` | アプリケーションが要求する権限。<br>要求する権限を`,`で区切って列挙します。権限の一覧は[こちら](./permission.md)で確認できます。 |

:::tip{label='例'}

```
https://misskey.io/miauth/c1f6d42b-468b-4fd2-8274-e58abdedef6f?name=MyApp&callback=https%3A%2F%2Fmyapp.example.com%2Fcallback&permission=write:notes,write:following,read:drive
```

:::

#### Step 3

ユーザーがアプリケーションアクセスを許可した後、次の形式のURLにPOSTリクエストすると、レスポンスとしてアクセストークンを含むJSONが返ります。

```
https://{host}/api/miauth/{session}/check
```

ここで、

- HTTP API는 모두 POST이며, 요청/응답 모두 JSON 형식입니다(drive/files/create 제외).
- 요청 헤더에 `Content-Type: application/json`을 지정합니다.

レスポンスに含まれるプロパティは以下の通りです:

| 名前      | 説明             |
| ------- | -------------- |
| `token` | ユーザーのアクセストークン。 |
| `user`  | ユーザーの情報。       |

## APIの利用

アクセストークンが取得できたら、各種エンドポイントにリクエストすることでAPIの利用が行えます。

:::tip

- HTTP APIはすべてPOSTで、リクエスト/レスポンスともにJSON形式です（drive/files/createを除く）。
- 要求ヘッダーに`Content-Type: application/json`を指定します。
- アクセストークンは、`i`というパラメータ名でリクエストボディJSONに含めます。
- ベースURLは`https://{サーバーのドメイン}/api`です。

:::

アクセストークン付きのボディの例（metaの場合）:

```json
{
    "i": "HogEFugA1341",
    "detail": false
}
```

<!--TODO:「APIリファレンス」をリンクに差し替え-->

APIの詳細は、APIリファレンスを参照してください。

:::warning

MisskeyはRESTを採用していません。

:::

また、MisskeyはHTTP APIだけでなく、ストリーミングAPIも提供しています。ストリーミングAPIの詳細は[こちらのドキュメント](./streaming/index.md)を参照してください。
